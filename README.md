# フランス語単語Ankiカード生成システム

## プロジェクトの概要

このプロジェクトは、フランス語学習用の単語カードを自動生成するシステムです。主な機能は以下の通りです：

1. フランス語の頻出単語をウェブからスクレイピング
2. 英語から日本語への高速な翻訳処理
3. Anki用のCSVファイル生成

## アーキテクチャの進化

### 初期実装の課題

最初の実装では、以下の問題点がありました：

1. **処理速度の問題**
   - Google Translate APIの呼び出しが逐次的
   - 1単語あたり0.5秒のスリープ時間が必要
   - 2000単語の処理に10-15分を要する

2. **APIレート制限**
   - 頻繁なAPI呼び出しによる制限リスク
   - エラーハンドリングの複雑さ

### マイクロサービスアーキテクチャへの移行

これらの課題を解決するため、以下の改善を実施しました：

1. **バイリンガルアーキテクチャの採用**
   - Python: スクレイピングと全体の制御
   - Go: 翻訳処理の並列実行
   
2. **gRPCによる通信**
   - 効率的なバイナリプロトコル
   - 型安全な通信
   - 双方向ストリーミングのサポート

3. **バッチ処理の導入**
   - 50単語ずつのバッチ処理
   - Goによる並列翻訳処理

## システム構成

```
.
├── generate_french_vocab.py    # メインスクリプト
├── requirements.txt            # Python依存関係
└── translator/                 # 翻訳マイクロサービス
    ├── proto/                 # プロトコル定義
    ├── server/                # Go翻訳サーバー
    └── client/                # Pythonクライアント
```

## 実装手順

1. **環境セットアップ**
   ```bash
   # Python仮想環境の作成
   python3 -m venv venv
   source venv/bin/activate
   
   # 依存関係のインストール
   pip install -r requirements.txt
   ```

2. **プロトコルの定義**
   - gRPC用のプロトコル定義
   - 単一翻訳とバッチ翻訳のサポート
   - Go/Python両言語用のコード生成

3. **Goサーバーの実装**
   - 並列翻訳処理
   - エラーハンドリング
   - コネクション管理

4. **Pythonクライアントの実装**
   - 非同期処理
   - バッチ処理
   - グレースフルなエラーハンドリング

## トラブルシューティング

### 1. 依存関係の問題

#### 問題
- `httpx`と`googletrans`のバージョン競合
- `protoc`コマンドの不足

#### 解決策
```bash
# バージョンの明示的な指定
httpx==0.13.3
googletrans==4.0.0-rc1

# protocのインストール
arch -arm64 brew install protobuf
```

### 2. プロトコル生成の問題

#### 問題
- `go_package`オプションの不足
- PATHの設定不足

#### 解決策
```protobuf
// proto/translator.proto
option go_package = "translator/proto";
```

```bash
export PATH="$PATH:$(go env GOPATH)/bin"
```

### 3. インポートパスの問題

#### 問題
- Pythonモジュールの相対インポートエラー

#### 解決策
```python
# 相対インポートから絶対インポートへの変更
from translator.proto import translator_pb2
```

## パフォーマンスの改善

### 改善前
- 処理時間: 10-15分
- 逐次処理
- API制限による待機時間

### 改善後
- 処理時間: 2-3分
- 並列処理
- バッチ処理による効率化

## 今後の課題

1. **エラーリカバリー**
   - 翻訳失敗時の再試行メカニズム
   - 部分的な処理結果の保存

2. **スケーラビリティ**
   - 複数翻訳サーバーの負荷分散
   - キャッシュ機構の導入

3. **モニタリング**
   - 処理状況の可視化
   - エラー率の監視

## 使用方法

1. サーバーの起動
   ```bash
   cd translator/server
   go run server.go
   ```

2. クライアントの実行
   ```bash
   python generate_french_vocab.py
   ```

## 注意事項

- Go 1.16以上が必要
- Python 3.7以上が必要
- 翻訳サーバーが起動していることを確認
- ネットワーク接続が必要 